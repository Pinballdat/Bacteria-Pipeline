

// Parameters
params {
    // Reads
    reads = "./01.RawData/*_{1,2}.fq.gz"
    // Outdir
    outdir = "./03.Results"
    // K2_database
    k2_database = "/data18tb/datnguyen/ONT_Gam/bacteria_db"
    // GO_db
    go_database = "/data18tb/datnguyen/LuanChu/test/go-basic.obo"
    // Reference
    reference = "/data18tb/datnguyen/LuanChu/02.Workflow/GCF_000009045.1_ASM904v1_genomic.fna"
    // Reference Genome path in NCBI
    ref_path = "https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/009/045/GCF_000009045.1_ASM904v1/GCF_000009045.1_ASM904v1_genomic.fna.gz"
    // Reference Annotation path in NCBI
    annot_path = "https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/009/045/GCF_000009045.1_ASM904v1/GCF_000009045.1_ASM904v1_genomic.gtf.gz"
}


// Process configuration
process {
    withName: FASTQC {
        cpus = 4
        conda = "/home/datnguyen/anaconda3/envs/fastqc"
        publishDir = [
            [
                path: "${params.outdir}/01.Raw_data_QC/html",
                mode: "copy",
                pattern: "*.html",
                overwrite: true
            ],
            [
                path: "${params.outdir}/01.Raw_data_QC/zip",
                mode: "copy",
                pattern: "*.zip",
                overwrite: true
            ]
        ]
        tag = "FastQC"
        time = "30m"
    }

    withName: TRIMMOMATIC {
        cpus = 24
        conda = "/home/datnguyen/anaconda3/envs/trimmomatic"
        publishDir = [
            [
                path: "${params.outdir}/02.Trimmed_reads/paired",
                mode: "copy",
                pattern: "*_paired.*.fq.gz",
                overwrite: true
            ],
            [ 
                path: "${params.outdir}/02.Trimmed_reads/unpaired",
                mode: "copy",
                pattern: "*_unpaired.*.fq.gz",
                overwrite: true
            ],
            [
                path: "${params.outdir}/02.Trimmed_reads/summary",
                mode: "copy",
                pattern: "*.summary.txt",
                overwrite: true
            ],
            [
                path: "${params.outdir}/02.Trimmed_reads/logs",
                mode: "copy",
                pattern: "*.log",
                overwrite: true
            ]
        ]
        tag = "Trimmomatic"
        time = "1h"
    }

    withName: FASTQC_2 {
        cpus = 4
        conda = "/home/datnguyen/anaconda3/envs/fastqc"
        publishDir = [
            [
                path: "${params.outdir}/03.Trimmed_data_QC/html",
                mode: "copy",
                pattern: "*.html",
                overwrite: true
            ],
            [
                path: "${params.outdir}/03.Trimmed_data_QC/zip",
                mode: "copy",
                pattern: "*.zip",
                overwrite: true
            ]
        ]
        tag = "FastQC_2"
        time = "30m"
    }

    withName: KRAKEN_READ {
        cpus = 12
        conda = "/home/datnguyen/anaconda3/envs/kraken2/"
        publishDir = [
            [
                path: "${params.outdir}/04.Taxonomy/Classification",
                mode: "copy",
                pattern: "*_classification.txt",
                overwrite: true
            ],
            [
                path: "${params.outdir}/04.Taxonomy/Report",
                mode: "copy",
                pattern: "*_report.txt",
                overwrite: true
            ]
        ]
        tag = "Kraken2"
        time = "2h"
    }

    withName: SPADES {
        cpus = 24
        conda = "/home/datnguyen/anaconda3/envs/spades"
        publishDir = [
            [
                path: "${params.outdir}/05.Assembly/Contigs",
                mode: "copy",
                pattern: "*_contigs.fasta",
                overwrite: true
            ],
            [
                path: "${params.outdir}/05.Assembly/Scaffolds",
                mode: "copy",
                pattern: "*_scaffolds.fasta",
                overwrite: true
            ],
            [
                path: "${params.outdir}/05.Assembly/Graphs",
                mode: "copy",
                pattern: "*_graph.fastg",
                overwrite: true
            ]
        ]
        tag = "Spades"
        time = "2h"
    }

    withName: BANDAGE {
        cpus = 1
        conda = "/home/datnguyen/anaconda3/envs/bandage"
        publishDir = [
            [
                path: "${params.outdir}/05.Assembly/Info",
                mode: "copy",
                pattern: "*_info.txt",
                overwrite: true
            ],
            [
                path: "${params.outdir}/05.Assembly/Image",
                mode: "copy",
                pattern: "*_image.png",
                overwrite: true
            ]
        ]
        tag = "Bandage"
        time = "5m"
    }

    withName: SEQKIT {
        cpus = 1
        conda = "/home/datnguyen/anaconda3/envs/seqkit"
        publishDir = [
            [
                path: "${params.outdir}/05.Assembly/Filtered_contigs",
                mode: "copy",
                pattern: "*_contigs.filtered.fasta",
                overwrite: true
            ],
            [
                path: "${params.outdir}/05.Assembly/Filtered_scaffolds",
                mode: "copy",
                pattern: "*._scaffolds.filtered.fasta",
                overwrite: true
            ]
        ]
            tag = "Seqkit"
            time = "5m"
    }

    withName: QUAST {
        cpus = 8
        conda = "/home/datnguyen/anaconda3/envs/quast"
        publishDir = [
            path: "${params.outdir}/06.Assembly_QC",
            mode: "copy",
            pattern: "*",
            overwrite: true
        ]
        tag = "Quast"
        time = "5m"
    }

    withName: BUSCO {
        cpus = 24
        conda = "/home/datnguyen/anaconda3/envs/busco"
        publishDir = [
            path: "${params.outdir}/07.Completeness",
            mode: "copy",
            pattern: "*.txt",
            overwrite: true
        ]
        tag = "Busco"
        time = "1h"
    }

    withName: PROKKA {
        cpus = 8
        conda = "/home/datnguyen/anaconda3/envs/prokka"
        publishDir = [
            path: "${params.outdir}/08.Completeness",
            mode: "copy",
            pattern: "*",
            overwrite: true
        ]
        tag = "Prokka"
        time = "30m"
    }

    withName: ABRICATE {
        cpus = 1
        conda = "/home/datnguyen/anaconda3/envs/abricate"
        publishDir = [
            path: "${params.outdir}/09.Specific_genes",
            mode: "copy",
            pattern: "*",
            overwrite: true
        ]
        tag = "Abricate"
        time = "10m"
    }

    withName: MLST {
        cpus = 1
        conda = "/home/datnguyen/anaconda3/envs/mlst"
        publishDir = [
            path: "${params.outdir}/10.MLST",
            mode: "copy",
            pattern: "*",
            overwrite: true
        ]
        tag = "mlst"
        time = "5m"
    }

    withName: EGGNOGMAPPER {
        cpus = 24
        conda = "/home/datnguyen/anaconda3/envs/eggnog_mapper"
        publishDir = [
            path: "${params.outdir}/11.eggnog_mapper",
            mode: "copy",
            pattern: "*.annotations",
            overwrite: true
        ]
        tag = "EggnogMapper"
        time = "1h"
    }

    withName: COGCLASSIFIER {
        cpus = 1
        conda = "/home/datnguyen/anaconda3"
        publishDir = [
            path: "${params.outdir}/12.Functional_classification/COG",
            mode: "copy",
            pattern: "*",
            overwrite: true
        ]
        tag = "COG Classifier"
        time = "10m"
    }

    withName: GOCLASSIFIER {
        cpus = 1
        conda = "/home/datnguyen/anaconda3"
        publishDir = [
            path: "${params.outdir}/13.Functional_classification/GO",
            mode: "copy",
            pattern: "*",
            overwrite: true
        ]
        tag = "GO Classifier"
        time = "10m"
    }

    withName: BWA_INDEX {
        cpus = 1
        conda = "/home/datnguyen/anaconda3/envs/bwa"
        publishDir = [
            path: "${params.outdir}/14.VariantCalling/index",
            mode: "copy",
            pattern: "*",
            overwrite: true
        ]
        tag = "Bwa index"
        time = "5m"
    }

    withName: BWA_MEM {
        cpus = 24
        conda = "/home/datnguyen/anaconda3/envs/bwa"
        publishDir = [
            path: "${params.outdir}/14.VariantCalling/Alignment",
            mode: "copy",
            pattern: "*.sam",
            overwrite: true
        ]
        tag = "Bwa mem"
        time = "2h"
    }

    withName: SAMTOOLS {
        cpus = 20
        conda = "/home/datnguyen/anaconda3/envs/samtools"
        publishDir = [
            path: "${params.outdir}/14.VariantCalling/Sorted",
            mode: "copy",
            pattern: "*.sorted.bam",
            overwrite: true
        ]
        tag = "Samtools"
        time = "1h"
    }

    withName: FREEBAYES {
        cpus = 1
        conda = "/home/datnguyen/anaconda3/envs/freebayes"
        publishDir = [
            path: "${params.outdir}/14.VariantCalling/Variants",
            mode: "copy",
            pattern: "*.vcf",
            overwrite: true
        ]
        tag = "Freebayes"
        time = "2h"
    }
    withName: SNPEFF_BUILD {
        cpus = 1
        conda = "/home/datnguyen/anaconda3/envs/snpeff"
        publishDir = [
            [
                path: "${params.outdir}/15.VariantCalling/Snp_annotation",
                mode: "copy",
                pattern: "data",
                overwrite: true
            ],
            [
                path: "${params.outdir}/15.VariantCalling/Snp_annotation",
                mode: "copy",
                pattern: "*.config",
                overwrite: true
            ]
        ]
        tag = "snpEff build"
        time = "10m"
    }

    withName: SNPEFF_ANN {
        cpus = 1
        conda = "/home/datnguyen/anaconda3/envs/snpeff"
        publishDir = [
            path: "${params.outdir}/15.VariantCalling/Snp_annotation",
            mode: "copy",
            pattern: "*",
            overwrite: true
        ]
        tag = "snpEff ann"
        time = "1h"
    }
}
